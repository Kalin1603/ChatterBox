@page
@model ChatterBox.Areas.Identity.Pages.Account.Manage.IndexModel
@{
    ViewData["Title"] = "Profile Settings";
}

<partial name="~/Areas/Identity/Pages/Account/_StatusMessage.cshtml" model="Model.StatusMessage" />

<main class="min-h-screen bg-slate-950 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 2xl:ml-[var(--w-side)] xl:ml-[var(--w-side-sm)] transition-all duration-300 mt-[var(--m-top)]">
    <div class="max-w-5xl w-full bg-slate-900/60 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden border border-slate-800/60 flex flex-col md:flex-row w-full min-h-[600px]">
        
        <!-- Internal Sidebar -->
        <div id="sidebar" class="w-full md:w-72 bg-slate-900/80 border-b md:border-b-0 md:border-r border-slate-800/60 flex-shrink-0">
            <div class="p-6 border-b border-slate-800/60">
                <h2 class="text-xl font-bold text-white tracking-tight">Settings</h2>
                <p class="text-slate-400 text-sm mt-1">Manage your account</p>
            </div>
            <nav class="p-4 space-y-2">
                <a asp-page="./Index"
                   class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group @(ViewData["ActivePage"] == ManageNavPages.Index ? "bg-indigo-600 text-white shadow-lg shadow-indigo-500/20" : "text-slate-400 hover:bg-slate-800 hover:text-slate-200")">
                    <ion-icon name="person-outline" class="text-xl"></ion-icon>
                    <span class="font-medium">Profile Info</span>
                </a>
                <a asp-page="./ChangePassword"
                   class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group @(ViewData["ActivePage"] == ManageNavPages.ChangePassword ? "bg-indigo-600 text-white shadow-lg shadow-indigo-500/20" : "text-slate-400 hover:bg-slate-800 hover:text-slate-200")">
                    <ion-icon name="lock-closed-outline" class="text-xl"></ion-icon>
                    <span class="font-medium">Password</span>
                </a>
                <a asp-page="./DeletePersonalData"
                   class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group @(ViewData["ActivePage"] == ManageNavPages.PersonalData ? "bg-red-500/10 text-red-400 hover:bg-red-500/20" : "text-slate-400 hover:bg-slate-800 hover:text-slate-200")">
                    <ion-icon name="trash-outline" class="text-xl"></ion-icon>
                    <span class="font-medium">Delete Account</span>
                </a>
            </nav>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 p-8 md:p-10 overflow-y-auto custom-scrollbar bg-gradient-to-br from-slate-900/50 to-slate-900/0">
            <div class="mb-8">
                <h1 class="text-2xl font-bold text-white tracking-tight">@ViewData["Title"]</h1>
                <p class="text-slate-400 mt-1">Update your public profile and personal details.</p>
            </div>

            <form id="profile-form" method="post" enctype="multipart/form-data" class="space-y-8">
                <div asp-validation-summary="ModelOnly" class="text-red-400 text-sm bg-red-500/10 p-4 rounded-xl border border-red-500/20" role="alert"></div>

                <!-- Profile Picture Section -->
                <div class="flex flex-col sm:flex-row items-center gap-8 pb-8 border-b border-slate-800/60">
                    <div class="relative group">
                        <div class="absolute -inset-0.5 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full opacity-50 blur group-hover:opacity-100 transition duration-500"></div>
                        <img id="profileSettings" src="@Model.Input.ProfilePictureUrl" alt="Profile"
                             class="relative w-32 h-32 rounded-full border-4 border-slate-900 object-cover shadow-2xl"
                             onerror="this.src='/images/default-profile.png'" />
                        
                        <label class="absolute bottom-0 right-0 bg-indigo-600 text-white p-2.5 rounded-full cursor-pointer shadow-lg hover:bg-indigo-500 transition-all duration-300 hover:scale-110 border-4 border-slate-900 z-10" title="Change photo">
                            <input type="file" id="ProfilePictureInput" name="ProfilePicture" class="hidden" accept="image/*" />
                            <ion-icon name="camera" class="text-xl block"></ion-icon>
                        </label>
                    </div>
                    <div class="text-center sm:text-left">
                        <h3 class="text-lg font-semibold text-white">Profile Photo</h3>
                        <p class="text-slate-400 text-sm mt-1 max-w-xs leading-relaxed">Upload a new avatar. Larger images will be resized automatically.</p>
                    </div>
                </div>

                <!-- Form Fields -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Username -->
                    <div class="space-y-2">
                        <label asp-for="Input.UserName" class="block text-sm font-medium text-slate-300">Username</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-500">
                                <ion-icon name="at-outline" class="text-lg"></ion-icon>
                            </span>
                            <input asp-for="Input.UserName" class="w-full pl-10 bg-slate-950/50 border border-slate-800 rounded-xl px-4 py-2.5 text-slate-400 focus:ring-0 focus:border-slate-700 cursor-not-allowed font-medium" readonly />
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="space-y-2">
                        <label asp-for="Input.Email" class="block text-sm font-medium text-slate-300">Email</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-500">
                                <ion-icon name="mail-outline" class="text-lg"></ion-icon>
                            </span>
                            <input asp-for="Input.Email" class="w-full pl-10 bg-slate-950/50 border border-slate-800 rounded-xl px-4 py-2.5 text-slate-400 focus:ring-0 focus:border-slate-700 cursor-not-allowed font-medium" readonly />
                        </div>
                    </div>

                    <!-- Full Name -->
                    <div class="space-y-2">
                        <label asp-for="Input.FullName" class="block text-sm font-medium text-slate-300">Full Name</label>
                        <input asp-for="Input.FullName" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-2.5 text-white focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all placeholder-slate-600" placeholder="John Doe" />
                        <span asp-validation-for="Input.FullName" class="text-red-400 text-xs"></span>
                    </div>

                    <!-- Date of Birth -->
                    <div class="space-y-2">
                        <label asp-for="Input.DateOfBirth" class="block text-sm font-medium text-slate-300">Date of Birth</label>
                        <input asp-for="Input.DateOfBirth" type="date" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-2.5 text-white focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all [color-scheme:dark]" />
                        <span asp-validation-for="Input.DateOfBirth" class="text-red-400 text-xs"></span>
                    </div>

                    <!-- Phone -->
                    <div class="space-y-2">
                        <label asp-for="Input.PhoneNumber" class="block text-sm font-medium text-slate-300">Phone Number</label>
                        <input asp-for="Input.PhoneNumber" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-2.5 text-white focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all placeholder-slate-600" />
                        <span asp-validation-for="Input.PhoneNumber" class="text-red-400 text-xs"></span>
                    </div>

                    <!-- Country -->
                    <div class="space-y-2">
                        <label asp-for="Input.Country" class="block text-sm font-medium text-slate-300">Country</label>
                        <input asp-for="Input.Country" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-2.5 text-white focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all placeholder-slate-600" />
                        <span asp-validation-for="Input.Country" class="text-red-400 text-xs"></span>
                    </div>
                </div>

                <!-- Address Section -->
                <div class="pt-6 border-t border-slate-800/60">
                    <h3 class="text-lg font-semibold text-white mb-6">Address Details</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label asp-for="Input.City" class="block text-sm font-medium text-slate-300">City</label>
                            <input asp-for="Input.City" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-2.5 text-white focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all placeholder-slate-600" />
                            <span asp-validation-for="Input.City" class="text-red-400 text-xs"></span>
                        </div>
                        <div class="space-y-2">
                            <label asp-for="Input.State" class="block text-sm font-medium text-slate-300">State / Province</label>
                            <input asp-for="Input.State" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-2.5 text-white focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all placeholder-slate-600" />
                            <span asp-validation-for="Input.State" class="text-red-400 text-xs"></span>
                        </div>
                        <div class="space-y-2">
                            <label asp-for="Input.Zip" class="block text-sm font-medium text-slate-300">ZIP Code</label>
                            <input asp-for="Input.Zip" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-2.5 text-white focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all placeholder-slate-600" />
                            <span asp-validation-for="Input.Zip" class="text-red-400 text-xs"></span>
                        </div>
                        <div class="md:col-span-3 space-y-2">
                            <label asp-for="Input.Address" class="block text-sm font-medium text-slate-300">Street Address</label>
                            <input asp-for="Input.Address" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-2.5 text-white focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all placeholder-slate-600" />
                            <span asp-validation-for="Input.Address" class="text-red-400 text-xs"></span>
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-end pt-6 border-t border-slate-800/60">
                    <button type="submit"
                            class="flex items-center justify-center gap-2 px-8 py-3 bg-indigo-600 hover:bg-indigo-500
                                   text-white rounded-xl transition-all duration-300 font-medium shadow-lg shadow-indigo-500/30 hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-slate-900">
                        <ion-icon name="save-outline" class="text-xl"></ion-icon>
                        <span>Save Changes</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</main>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        setTimeout(function () {
            let alertElement = document.querySelector(".alert-dismissible");
            if (alertElement) {
                let bsAlert = new bootstrap.Alert(alertElement);
                bsAlert.close();
            }
        }, 5000);

        document.getElementById("ProfilePictureInput").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById("profileSettings").src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
}